## 背景与目标
- 当前项目未实现登录/认证，但已使用 `Zustand + persist` 持久化 `preferences`（src/store/index.ts:85-90）。
- 目标：在用户第一次使用（首次访问）时弹出一个表单，收集饮食偏好，并持久化保存，后续不再打扰。

## 触发条件与状态
- 新增全局布尔状态 `hasOnboarded`（默认 `false`，持久化存储）。
- 首次访问判定：当 `hasOnboarded === false` 时展示弹窗。
- 代码参考：
  - 偏好默认值与持久化键：`src/store/index.ts:49-55`, `src/store/index.ts:85`。
  - 目前仅持久化 `preferences`：`src/store/index.ts:86-90`（计划扩展为同时持久化 `hasOnboarded`）。

## UI与交互设计
- 采用轻量级弹窗组件（Tailwind 样式，原生 Portal），不引入第三方 UI 库。
- 弹窗内嵌“偏好设置表单”，字段与现有页面一致，简洁可读：
  - 菜系多选、价格区间（连选）、距离范围（单选）、饮食限制（多选）、可选就餐时段。
- 提供两个动作：
  - “保存偏好并开始使用” → 写入 `preferences`，设置 `hasOnboarded=true`，关闭弹窗。
  - “稍后再说” → 仅设置 `hasOnboarded=true`（不强制填写），关闭弹窗。

## 代码改动（保持模块化，尽量复用）
1. `src/store/index.ts`
   - 新增：`hasOnboarded: boolean` 与 `setOnboarded(onboarded: boolean)`。
   - `persist.partialize` 扩展为持久化 `{ preferences, hasOnboarded }`。
2. `src/components/Modal.tsx`（新建，必要文件）
   - 轻量弹窗组件：支持遮罩、居中容器、ESC/点击遮罩关闭（可配置）。
3. `src/components/PreferenceForm.tsx`（新建，必要文件）
   - 将 `src/pages/Preferences.tsx` 中的核心表单提炼为可复用组件（受控 props + 回调）。
   - 该组件在“偏好设置页面”和“首次访问弹窗”中复用，避免重复代码。
4. `src/pages/Preferences.tsx`
   - 使用 `PreferenceForm` 以减少重复，并保持现有交互与导航行为不变。
5. `src/App.tsx`（或 `src/pages/Home.tsx`）
   - 全局挂载首次访问检测逻辑：`!hasOnboarded` 时渲染 `Modal + PreferenceForm`。
   - 建议在 `App.tsx` 实现，以保证从任何入口首次打开都能弹窗。

## 数据流与保存
- 读取与更新：通过 `useAppStore.updatePreferences` 写偏好，通过 `setOnboarded(true)` 标记完成。
- 与推荐逻辑的关系：首页“开始推荐”会使用 `preferences`（`useRestaurants` 中返回，src/hooks/useRestaurants.ts:79, 118-119）。

## 验证方案
- 类型检查：`pnpm tsc --noEmit --project tsconfig.strict.json`。
- 交互验证：运行开发服务，清空本地存储后首次打开应看到弹窗；保存后弹窗不再出现。
- 预提交校验：确保现有 Husky/tsc 检查通过。

## 实施原则
- 代码简洁：2 空格缩进、函数级 JSDoc、文件末尾空行。
- 不过度设计：不引入额外 UI 库，弹窗与表单只做必要功能。
- 模块化复用：表单拆分为独立组件供页面与弹窗共享。

## 交付内容
- 首次访问弹窗 + 偏好表单生效，偏好和首次完成标记持久化，后续不再打扰；现有“偏好设置”页面保持可用。